<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather System Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h2 {
            color: #0038b8;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 10px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #dee2e6;
        }
        .weather-display {
            font-size: 24px;
            font-weight: bold;
            color: #0038b8;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üå§Ô∏è VFI News Weather System Test</h1>
    
    <div class="test-section">
        <h2>1. Weather Data File Check</h2>
        <div id="fileCheck"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Weather Data Content</h2>
        <div id="weatherContent"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Current Weather Display</h2>
        <div id="weatherDisplay"></div>
    </div>
    
    <div class="test-section">
        <h2>4. System Status</h2>
        <div id="systemStatus"></div>
    </div>

    <script>
        async function testWeatherSystem() {
            const fileCheck = document.getElementById('fileCheck');
            const weatherContent = document.getElementById('weatherContent');
            const weatherDisplay = document.getElementById('weatherDisplay');
            const systemStatus = document.getElementById('systemStatus');
            
            try {
                // Test 1: Check if file exists
                const response = await fetch('weather_data.json?t=' + new Date().getTime());
                
                if (!response.ok) {
                    fileCheck.innerHTML = '<div class="status error">‚ùå Weather data file not found! Make sure weather_updater.py is running.</div>';
                    throw new Error('File not found');
                }
                
                fileCheck.innerHTML = '<div class="status success">‚úì Weather data file found and accessible</div>';
                
                // Test 2: Parse JSON
                const data = await response.json();
                weatherContent.innerHTML = `
                    <div class="status success">‚úì JSON data parsed successfully</div>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                
                // Test 3: Display weather
                if (data.status === 'ok') {
                    const description = data.description.toLowerCase();
                    let icon = '‚õÖ';
                    
                    if (description.includes('clear')) icon = '‚òÄÔ∏è';
                    else if (description.includes('rain')) icon = 'üåßÔ∏è';
                    else if (description.includes('cloud')) icon = '‚òÅÔ∏è';
                    else if (description.includes('storm')) icon = '‚õàÔ∏è';
                    
                    weatherDisplay.innerHTML = `
                        <div class="status success">‚úì Weather data is valid</div>
                        <div class="weather-display">
                            ${icon} ${data.temperature}¬∞C - ${data.description}
                        </div>
                        <p><strong>Feels like:</strong> ${data.feels_like}¬∞C</p>
                        <p><strong>Humidity:</strong> ${data.humidity}%</p>
                        <p><strong>Wind Speed:</strong> ${data.wind_speed} km/h</p>
                        <p><strong>Last Updated:</strong> ${data.updated}</p>
                    `;
                } else {
                    weatherDisplay.innerHTML = '<div class="status error">‚ùå Weather data status is not OK</div>';
                }
                
                // Test 4: System status
                const now = new Date();
                const updated = new Date(data.updated);
                const ageMinutes = Math.floor((now - updated) / 60000);
                
                let ageStatus = 'success';
                let ageMessage = `‚úì Data is fresh (${ageMinutes} minutes old)`;
                
                if (ageMinutes > 15) {
                    ageStatus = 'error';
                    ageMessage = `‚ö†Ô∏è Data is stale (${ageMinutes} minutes old). Weather updater may not be running.`;
                } else if (ageMinutes > 10) {
                    ageStatus = 'info';
                    ageMessage = `‚ÑπÔ∏è Data is ${ageMinutes} minutes old. Next update due soon.`;
                }
                
                systemStatus.innerHTML = `
                    <div class="status ${ageStatus}">${ageMessage}</div>
                    <p><strong>Weather Source:</strong> wttr.in (free service)</p>
                    <p><strong>Update Interval:</strong> Every 10 minutes</p>
                    <p><strong>Display Refresh:</strong> Every 60 seconds</p>
                    <div class="status info">
                        <strong>To start weather updater:</strong><br>
                        Run <code>start_weather_updater.bat</code> or <code>python weather_updater.py</code>
                    </div>
                `;
                
            } catch (error) {
                console.error('Test error:', error);
                
                if (!fileCheck.innerHTML.includes('error')) {
                    fileCheck.innerHTML = '<div class="status error">‚ùå Error loading weather data</div>';
                }
                
                systemStatus.innerHTML = `
                    <div class="status error">
                        <strong>System Error:</strong> ${error.message}<br><br>
                        <strong>Solution:</strong><br>
                        1. Run <code>start_weather_updater.bat</code><br>
                        2. Wait a few seconds for initial data fetch<br>
                        3. Refresh this page
                    </div>
                `;
            }
        }
        
        // Run test on load
        testWeatherSystem();
        
        // Auto-refresh every 30 seconds
        setInterval(testWeatherSystem, 30000);
    </script>
</body>
</html>
